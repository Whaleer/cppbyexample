
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->
# 端口占用问题解决文档

## 问题描述

运行 `./tools/serve` 时出现错误：

```
OSError: [Errno 48] Address already in use
```

## 问题原因

端口 8000 已被之前的 HTTP 服务器进程占用。

## 解决方案

### 方案 1：查找并关闭占用端口的进程（推荐）

```bash
# 查找占用 8000 端口的进程
lsof -i :8000
```

输出示例：
```
COMMAND   PID    USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME
python3  12345  bingxil   3u  IPv4 0x12345678      0t0  TCP *:8000 (LISTEN)
```

关闭进程：
```bash
kill 12345
```

如果无法关闭，强制关闭：
```bash
kill -9 12345
```

### 方案 2：关闭所有 Python HTTP 服务器

```bash
pkill -f "python3.*http.server"
```

### 方案 3：使用不同端口

如果不想关闭现有服务，可以使用其他端口：

```bash
python3 -m http.server 8001 --directory public
```

然后在浏览器访问 `http://127.0.0.1:8001`

### 方案 4：修改默认端口

永久修改默认端口，编辑 `tools/serve`：

```bash
#!/usr/bin/env bash

cd "$(dirname "$0")/.."
python3 -m http.server 8001 --directory public
```

## 验证

解决后，重新启动服务器：

```bash
./tools/serve
```

应该在终端看到：

```
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

## 预防措施

### 正确关闭服务器

**前台运行时：** 使用 `Ctrl+C` 停止

**后台运行时：** 始终使用 `pkill` 或 `lsof` 查找并关闭

### 检查端口占用

启动前检查端口是否被占用：

```bash
lsof -i :8000
```

如果没有任何输出，说明端口可用。

## 相关命令速查

| 命令 | 用途 |
|------|------|
| `lsof -i :8000` | 查找占用 8000 端口的进程 |
| `pkill -f "http.server"` | 关闭所有 HTTP 服务器 |
| `kill <PID>` | 关闭指定 PID 的进程 |
| `kill -9 <PID>` | 强制关闭进程 |
| `ps aux \| grep http.server` | 查看所有 HTTP 服务器进程 |
